<form  #form="ngForm" (ngSubmit)="onSubmit()" novalidate>

    <h1>Confimação de Pedidos</h1>

    <mat-form-field>
        <mat-label>Mês</mat-label>
        <mat-select [(ngModel)]="mes" name="mes" required>
            <mat-option [value]="1">Janeiro</mat-option>
            <mat-option [value]="2">Fevereiro</mat-option>
            <mat-option [value]="3">Março</mat-option>
            <mat-option [value]="4">Abril</mat-option>
            <mat-option [value]="5">Maio</mat-option>
            <mat-option [value]="6">Junho</mat-option>
            <mat-option [value]="7">Julho</mat-option>
            <mat-option [value]="8">Agosto</mat-option>
            <mat-option [value]="9">Setembro</mat-option>
            <mat-option [value]="10">Outubro</mat-option>
            <mat-option [value]="11">Novembro</mat-option>
            <mat-option [value]="12">Dezembro</mat-option>
        </mat-select>
    </mat-form-field>

    <mat-form-field>
        <mat-label>Ano</mat-label>
        <input matInput
            type="number" 
            name="ano" 
            [(ngModel)]="ano"
            inputmode="numeric"
            required>  
    </mat-form-field>

    <button id="btn-listar" matButton="filled" type="submit" [disabled]="!form.valid">
        Listar
    </button>
</form>

<form #form="ngForm">
    @for (pedido of pedidos; track pedido.id) {
        <div>

            <h2>{{ pedido.tipo }} - {{ pedido.data | date:'dd/MM/yyyy' }}</h2>

            <table mat-table [dataSource]="pedido.itens">

                <ng-container matColumnDef="nome">
                    <th mat-header-cell *matHeaderCellDef>  </th>
                    <td mat-cell *matCellDef="let item"> {{item.nome}} </td>
                    <td mat-footer-cell *matFooterCellDef> Total </td>
                </ng-container>

                <ng-container matColumnDef="quantidade">
                    <th mat-header-cell *matHeaderCellDef> Quantidade </th>
                    <td mat-cell *matCellDef="let item"> {{item.quantidade}} </td>
                    <td mat-footer-cell *matFooterCellDef> {{ getTotalQuantidade(pedido.itens) }} </td>
                </ng-container>

                <ng-container matColumnDef="valorTotal">
                    <th mat-header-cell *matHeaderCellDef> Valor Total </th>
                    <td mat-cell *matCellDef="let item"> {{item.valorTotal | currency:'BRL' }} </td>
                    <td mat-footer-cell *matFooterCellDef> {{ getTotalValue(pedido.itens) | currency:'BRL' }} </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                <tr mat-footer-row *matFooterRowDef="['nome', 'quantidade', 'valorTotal']"></tr>

            </table>
            
            @if(!pedido.confirmado) { 
                <button matButton (click)="confirmarPagamento(pedido.id)">Confirmar Pagamento</button>
                <button matButton (click)="cancelarPedido(pedido.id)">Cancelar</button>
            }
        </div> 
    }
</form>
